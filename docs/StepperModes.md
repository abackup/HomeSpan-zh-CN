<!--  原文时间：2023.7.1,翻译时间：2024.5.7，校对时间：2024.7.12  -->

# 步进电机模式

一个典型的步进电机有两组线圈，*A* 和 *B*。向一个或两个线圈施加电流会产生固定电机位置的磁场。流经线圈的电流的方向和/或大小的任何变化都会导致电动机“步进”到新的固定位置。通过根据特定模式重复地改变电流，可以使电动机连续地顺时针或逆时针步进。所选择的特定模式（在 **StepperControl** 类中称为*步进模式*）决定了步进的大小和电机的整体性能。电流变化的速度决定了电机旋转的速度。支持 **StepperControl** 的模式如下所述。

## 全步长两相模式（无 PWM）

在此模式下，向线圈 *A* 和 *B* 施加恒定电流。通过交替翻转每个线圈中的电流方向来步进电机，如下所示：

<img width="250" alt="image" src="https://github.com/HomeSpan/HomeSpan/assets/68477936/8bea7031-7325-4ded-8ebd-5554d8f1e13d"><br>

请注意，尽管模式在四个步骤后重复，但它不是对称的——从左到右运行模式会导致电机沿一个方向旋转，而从右到左运行模式会导致电机沿相反方向旋转。许多步进电机被构造为具有 200 个完整的步骤，这意味着你需要重复上述模式 25 次才能使电机完成一次旋转。

由于在该模式中，每个线圈仅具有两个可能的状态（即电流的方向），因此每个线圈仅需要一个数字信号来实现步进模式。然而，完全翻转线圈中的电流方向会非常迅速地改变磁场，这会在步进电机时产生相当笨拙的运动。

## 全步一相模式（无 PWM）

在此模式下，恒定电流交替施加到其中之一 *A* *或者* *B*，同时还按如下方式翻转其方向：

<img width="250" alt="image" src="https://github.com/HomeSpan/HomeSpan/assets/68477936/cbf2fea5-072e-4fef-9231-504bb483b0c0"><br>

由于电流一次仅流过一个线圈，因此该模式仅使用全步两相模式一半的功率。此外，尽管步长相同，但由于每个线圈的电流在翻转到另一个方向之前从一个方向转换到零，因此从一个步到另一个步的转换并不苛刻。然而，由于在该模式下，每个线圈具有三种可能的电流状态（正、负和关），因此每个线圈需要两个数字信号来实现步进模式。

## 半步模式（无 PWM）

尽管上述两种模式的步长是相同的，但当电机旋转时，它们所代表的一组位置不同步 1/2 步。这意味着，通过将两种模式的四个步骤交错在一起，我们可以创建以下 8 步模式，其中步长为*半*个完整步骤的步长：
      
<img width="400" alt="image" src="https://github.com/HomeSpan/HomeSpan/assets/68477936/ec317c77-fbd9-4641-9d50-d822b477c9ec"><br>

这种模式的优点是电机移动更加平稳，并且可以以半步增量停止，以便进行更精确的控制。然而，电机需要两倍的步数才能完成一次完整的旋转（因此，在步数之间的延迟相同的情况下，移动速度要慢两倍）。

这种模式的另一个缺点是，在四个步骤中，两个线圈都被供电，而在另外四个步骤中，只有一个线圈被供电。当电机旋转时，这会导致不均匀的电机扭矩，以及不同的保持扭矩，这取决于电机停止时所处的步骤。根据你的具体应用（拉起窗帘、关门等），这可能是也可能不是问题。

## 四分之一步和八分之一步模式（包括上述模式的 PWM 版本）

在上述模式中，每个线圈的电流要么在一个方向上“完全开启”，要么在另一个方向上完全开启，要么完全关闭。因此，在步进粒度和旋转平滑度与功率和扭矩一致性之间存在折衷。该问题的解决方案是用 PWM 信号（或等效的限制机制）来驱动每个线圈中的电流，该 PWM 信号除了允许控制电流的方向之外，还允许控制电流*震级*的方向。

通常，这是通过基于偏移 90° 的正弦模式设置每个线圈中的电流幅度来实现的，如下所示：

<img width="505" alt="image" src="https://github.com/HomeSpan/HomeSpan/assets/68477936/75a6176b-b5b4-4b85-a394-a4d6e1f9bf3d"><br>

这里，蓝点完美地复制了全步一相模式的步骤（例如，线圈 *A* 的正/关/负/关），红点复制了全步二相模式的步骤，并且红点和蓝点的组合集一起复制了半步模式的步骤。因此，上述每个非 PWM 模式都可以使用单组基于 PWM 的正弦曲线来复制，但有一个重要的区别：PWM 方法在每个模式中的每一步都产生相同的功率，避免了上述非 PWM 模式的不一致转矩的问题。这是因为功率通常与*正方形*流过线圈的电流的大小成比例；线圈 *A* 遵循余弦曲线；线圈 *B* 遵循正弦曲线；和 $cos^2+sin^2=1$，这是一个常数。

如果 PWM 信号可用，当以上述三种模式中的任何一种运行电机时，通常优选使用 PWM 方法，而不是仅以施加到每个线圈的恒定电流运行。幸运的是，许多步进电机驱动器板包含内置的 PWM 模块。如果没有，你可以使用 ESP32 的内置 PWM 外设生成 **StepperControl** 所需的 PWM 信号。

除了提供更好的电机性能之外，PWM 方法还通过将“微步”添加到步进模式来提供更精细的步进模式。例如，在半步之间添加 8 个额外的步骤，如在曲线上由放置在蓝点和红点之间的 8 个黑色菱形所指示的，产生四分之一步模式。该模式的“平滑度”是半步模式的两倍，但电机需要两倍的步数才能完成一次完整的旋转。将步骤进一步减半（图中未显示）产生第八步模式，其中每个循环包含 32 个单独的步进点。**StepperControl** 支持四分之一步和八分之一步模式，但你可以通过添加每周期 64 或 128 步的模式来轻松地进一步扩展。对于设计用于操作窗帘的电机，通常不需要这样的粒度，并且根据电机的具体特性，太细的粒度会导致错误。

---

[↩️](Stepper.md) 返回控制步进电机页面
